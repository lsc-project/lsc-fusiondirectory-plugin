<?xml version="1.0" ?>
<lsc xmlns="http://lsc-project.org/XSD/lsc-core-2.2.xsd"
	revision="0"
	xmlns:fusiondirectory="http://lsc-project.org/XSD/lsc-fusiondirectory-plugin-1.2.xsd">
	<!--
	See online documentation:
	     - LSC: https://lsc-project.org/documentation/latest/index_configuration.html
	     - FusionDirectory plugin: https://github.com/lsc-project/lsc-fusiondirectory-plugin/blob/master/README.md
	-->
	<connections>
		<pluginConnection>
			<name>fusiondirectory</name>
			<url>https://fusion.lxd/rest.php/v1</url>
			<username>fd-admin</username>
			<password>secret</password>
		</pluginConnection>
		<ldapConnection>
			<name>openldap</name>
			<url>ldap://fusion.lxd/dc=my-domain,dc=com</url>
			<username>cn=Manager,dc=my-domain,dc=com</username>
			<password>secret</password>
			<authentication>SIMPLE</authentication>
			<referral>IGNORE</referral>
			<derefAliases>NEVER</derefAliases>
			<version>VERSION_3</version>
			<pageSize>-1</pageSize>
			<factory>com.sun.jndi.ldap.LdapCtxFactory</factory>
			<tlsActivated>false</tlsActivated>
			<saslMutualAuthentication>false</saslMutualAuthentication>
		</ldapConnection>
	</connections>
	<tasks>
		<task>
			<name>Users</name>
			<bean>org.lsc.beans.SimpleBean</bean>
			<ldapSourceService>
				<name>src-service</name>
				<connection reference="openldap" />
				<baseDn>ou=ldap,dc=my-domain,dc=com</baseDn>
				<pivotAttributes>
					<string>uid</string>
				</pivotAttributes>
				<fetchedAttributes>
					<string>objectclass</string>
					<string>uid</string>
					<string>cn</string>
					<string>sn</string>
					<string>givenName</string>
					<string>mail</string>
					<string>title</string>
				</fetchedAttributes>
				<getAllFilter><![CDATA[(objectClass=inetOrgPerson)]]></getAllFilter>
				<getOneFilter><![CDATA[(&(objectClass=inetOrgPerson)(uid={uid}))]]></getOneFilter>
				<cleanFilter><![CDATA[(&(objectClass=inetOrgPerson)(uid={uid}))]]></cleanFilter>
			</ldapSourceService>
			<pluginDestinationService implementationClass="org.lsc.plugins.connectors.fusiondirectory.FusionDirectoryDstService">
				<name>fusiondirectory-users-dest-service</name>
				<connection reference="fusiondirectory" />
				<fusiondirectory:serviceSettings>
					<name>fusiondirectory-service-settings</name>
					<connection reference="fusiondirectory" />
					<fusiondirectory:sessionLifetime>300</fusiondirectory:sessionLifetime>
					<fusiondirectory:entity>USER</fusiondirectory:entity>
					<fusiondirectory:pivot>uid</fusiondirectory:pivot>
					<fusiondirectory:base>ou=fusion,dc=my-domain,dc=com</fusiondirectory:base>
					<fusiondirectory:filter><![CDATA[(objectClass=inetOrgPerson)]]></fusiondirectory:filter>
					<fusiondirectory:oneFilter><![CDATA[(uid={uid})]]></fusiondirectory:oneFilter>
					<fusiondirectory:attributes>
						<fusiondirectory:tab name="user">
							<fusiondirectory:attribute>uid</fusiondirectory:attribute>
							<fusiondirectory:attribute>cn</fusiondirectory:attribute>
							<fusiondirectory:attribute>base</fusiondirectory:attribute>
							<fusiondirectory:attribute>sn</fusiondirectory:attribute>
							<fusiondirectory:attribute>givenName</fusiondirectory:attribute>
							<fusiondirectory:attribute
								multiple="true">title</fusiondirectory:attribute>
							<fusiondirectory:attribute
								passwordHash="empty">userPassword</fusiondirectory:attribute>
						</fusiondirectory:tab>
						<fusiondirectory:tab name="mailAccount">
							<fusiondirectory:attribute>mail</fusiondirectory:attribute>
						</fusiondirectory:tab>
					</fusiondirectory:attributes>
				</fusiondirectory:serviceSettings>
			</pluginDestinationService>
			<propertiesBasedSyncOptions>
				<mainIdentifier><![CDATA[srcBean.getDatasetFirstValueById("uid")]]></mainIdentifier>
				<defaultDelimiter>;</defaultDelimiter>
				<defaultPolicy>FORCE</defaultPolicy>
				<conditions>
					<create>true</create>
					<update>true</update>
					<delete>true</delete>
					<changeId>false</changeId>
				</conditions>
				<dataset>
					<name>userPassword</name>
					<policy>KEEP</policy>
					<createValues>
						<string><![CDATA[""]]></string>
					</createValues>
				</dataset>
				<dataset>
					<name>base</name>
					<policy>FORCE</policy>
					<forceValues>
						<string>"ou=fusion,dc=my-domain,dc=com"</string>
					</forceValues>
				</dataset>
			</propertiesBasedSyncOptions>
		</task>
	</tasks>
</lsc>
